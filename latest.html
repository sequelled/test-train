<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, maximum-scale=1">
<title>sequelled</title>
<link rel="icon" href="favicon.png" type="image/png">
<link href="css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="css/style.css" rel="stylesheet" type="text/css">
<link href="css/linecons.css" rel="stylesheet" type="text/css">
<link href="css/font-awesome.css" rel="stylesheet" type="text/css">
<link href="css/responsive.css" rel="stylesheet" type="text/css">
<link href="css/animate.css" rel="stylesheet" type="text/css">

<link href='http://fonts.googleapis.com/css?family=Lato:400,900,700,700italic,400italic,300italic,300,100italic,100,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Dosis:400,500,700,800,600,300,200' rel='stylesheet' type='text/css'>

<!--[if IE]><style type="text/css">.pie {behavior:url(PIE.htc);}</style><![endif]-->

<script type="text/javascript" src="js/jquery.1.8.3.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/jquery-scrolltofixed.js"></script>
<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="js/jquery.isotope.js"></script>
<script type="text/javascript" src="js/wow.js"></script>
<script type="text/javascript" src="js/classie.js"></script>

<!--[if lt IE 9]>
    <script src="js/respond-1.1.0.min.js"></script>
    <script src="js/html5shiv.js"></script>
    <script src="js/html5element.js"></script>
<![endif]-->

<script type="text/javascript">
	$(document).ready(function(e) {
        $('.res-nav_click').click(function(){
		$('ul.toggle').slideToggle(600)	
			});	
			
	$(document).ready(function() {
$(window).bind('scroll', function() {
         if ($(window).scrollTop() > 0) {
             $('#header_outer').addClass('fixed');
         }
         else {
             $('#header_outer').removeClass('fixed');
         }
    });
	
	  });
	  

		    });	
function resizeText() {
	var preferredWidth = 767;
	var displayWidth = window.innerWidth;
	var percentage = displayWidth / preferredWidth;
	var fontsizetitle = 25;
	var newFontSizeTitle = Math.floor(fontsizetitle * percentage);
	$(".divclass").css("font-size", newFontSizeTitle)
}
</script>
</head>
<body>

<!--Header_section-->
<header id="header_outer">
  <div class="container">
    <div class="header_section">
      <div class="logo"><a href="index.html"><img src="img/logob.png" alt=""></a></div>
      <nav class="nav" id="nav">
        <ul class="toggle">
          <li><a href="index.html">Home</a></li>
          <li><a href="design.html">Design</a></li>
          <li><a href="optimize.html">Optimize</a></li>
          <li><a href="maintain.html">Maintenance</a></li>
          <li><a href="latest.html">Latest Work</a></li>
          <li><a href="about.html">About us</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
        <ul class="">
          <li><a href="index.html">Home</a></li>
          <li><a href="design.html">Design</a></li>
          <li><a href="optimize.html">Optimize</a></li>
          <li><a href="maintain.html">Maintenance</a></li>
          <li><a href="latest.html">Latest Work</a></li>
          <li><a href="about.html">About us</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </nav>
      <a class="res-nav_click animated wobble wow"  href="javascript:void(0)"><i class="fa-bars"></i></a> </div>
  </div>
</header>
<!--Header_section--> 




<section id="partitioning"><br><br><br><br><br><br><br><br></section><!--main-section-start-->
<section>
<div class="container">
    <h2>Table Partitioning</h2>
    </div>
  </div>
</section>
<!--main-section-end--> 

<!--Service-->
<section  id="service">
  <div class="container">
    <p>  <a href="https://en.wikipedia.org/wiki/Partition_(database)">Table partitioning</a> is a concept where one large table is split into several smaller tables. This can bring dramatic improvement in query performance, while opening the possibility of dropping old data to a backup storage. A good rule of thumb is to use partioning when the size of the table grows larger than the amount of physical ram on the server. 
    </p>
    <br>
    <p>
    Table partitioning is based on inheritance property, where the master table works as a template and the child tables inherit all properties of the master table, divided by some pre-selected criteria. 
    </p>
    <br>
    <p>On a recent project, we successfully used table partitioning to gain 10x performance improvement.</p>
    <br>
    <p>
    Let us look at an example. Let's assume you have a software that deals with weather in 50 Canadian cities. Your sensors take 3 samples per second, so they roughly stores (3 x 60 x 60 x 24 x 365) = 94,608,000 ~ 100 million rows of data per year. 
    
    Let us create a table called "weather", which has a pseudo id column, city name, temperature and the time of day when the data was taken. 
    </p>

	<pre><code>create table public.weather(
	id   bigserial,
	city text,
	temperature float,
	date text	
);</code></pre>
    <br>
    <p>Now let's populate some data into the table. We will add 100 million rows by randomly selecting from a list of 50 cities, a random temperature and a random timestamp within a range.</p>
    <pre><code>do $$  
    begin
	for i in 1..10000000 loop
		insert into public.weather(
			city, 
			temperature, 
			date)
		values
			(
			(select (array['Toronto','Calgary','Edmonton','Kamloops','Neils Harbour','Norman','Luskville','Thornhill','Penny','Rae','Cromer','Hearst','Shippigan','Chandik','Ganges','Kuldo','Opastika','Kimmirut','Bonaventure','Wilberforce','Makamik','Piquitona','Prince Albert','Nechacco','Neilburg','Tennycape','Sagawitchewan','Salliq','Tecumseh','Sicamous','Hutshi','Thamesford','Smiths Falls','Coutts','Harrow','Belbutte','North Vancouver','Olds','Oungre','Elrose','Taku','Esther','Walkerton','Fort Saskatchewan','Cascapedia','Warden','Peakes','Redroofs','Seldom','Edmundston'])[floor(random()*50)+1]),
			(select random() * 70 + 30),
			(select timestamp '2015-01-01 00:00:00' + random() * (timestamp '2016-02-01 23:59:59' - timestamp '2015-01-01 00:00:00')::text)	
			);
	end loop;
    end;
$$ language 'plpgsql';</code></pre>
    <br>
    Now let us query what the temperatures were at Toronto in July 2015, and see how long it takes to execute the query.

    <pre><code>explain analyze
    select * from public.weather where city = 'Toronto' and date >= '2015-07-01' and date <= '2015-07-31'</code></pre>
    <br>
    <p>As we can see below, it took 8.18 seconds to find the result, undoubtedly slow for day to day use. It had to sequentially scan 100,000,000 rows to find the result.<p>
    <pre><code>Seq Scan on weather  (cost=0.00..286045.42 rows=997 width=57) (actual time=1.599..8181.472 rows=15301 loops=1)
  Filter: ((date >= '2015-07-01'::text) AND (date <= '2015-07-31'::text) AND (city = 'Toronto'::text))
  Rows Removed by Filter: 9984699
Planning time: 0.090 ms
Execution time: 8182.835 ms</code></pre><br>

   <p>Now let us partition the table by year and month. So, we will create a trigger function, which upon each insert will check if the child table exists, and if it doesn't exist, will create a child table in the format public.weather_yyyy_mm. Then we add 100 million rows using the same script above, which creates 14 child tables within our datetime range.</p>
   
   <br>
   
   <p>Now let us see how it performs after the partition.</p>

   <pre><code>explain analyze
	    select * from public.weather_partitioned where city = 'Toronto' and date >= '2015-07-01' and date <= '2015-07-31';
        
    Append  (cost=0.00..22191.22 rows=14836 width=51) (actual time=0.215..834.205 rows=15301 loops=1)
  ->  Seq Scan on weather  (cost=0.00..0.00 rows=1 width=80) (actual time=0.001..0.001 rows=0 loops=1)
        Filter: ((date >= '2015-07-01'::text) AND (date <= '2015-07-31'::text) AND (city = 'Toronto'::text))
  ->  Seq Scan on weather_2015_07  (cost=0.00..22191.22 rows=14835 width=51) (actual time=0.212..833.237 rows=15301 loops=1)
        Filter: ((date >= '2015-07-01'::text) AND (date <= '2015-07-31'::text) AND (city = 'Toronto'::text))
        Rows Removed by Filter: 766426
Planning time: 0.623 ms
Execution time: 834.984 ms</code></pre><br>
    
    <p>As we can see, the query time has been dropped to 0.8 seconds, almost 10 fold improvement over unpartitioned table.</p>
  </div>
</section>
<!--Service-->
<section id="indexing"><br><br><br><br><br><br><br><br></section>
<section><!--main-section-start-->
<div class="container">
    <h2>Multicolumn Indexing</h2>
    </div>
  </div>
</section>
<!--main-section-end--> 

<!--Service-->
<section  id="service">
  <div class="container">
    <p>Postgres supports different types of indexing, among which B-tree and GiST index types can have multicolumn indexes, which can be very useful in certain conditions.  
    </p>
    <br>
    <p>
    Let's look at the same example as above. For 100 million rows, selecting the rows for a particular city for a particular month took more than 8 seconds for the unpartitioned table. 
    </p>
    <br>
    <p>
    Now, let us add a multicolumn index for the column city and date, and see how it impacts the performance. 
    </p>
    <pre><code>create index idx_city_date on public.weather(city, date);</code></pre>
    <br>
    <p>
     As we can see below, the query now executes around 0.1 seconds, almost 80 times improvement. 
     <pre><code>Bitmap Heap Scan on weather  (cost=45.12..3706.99 rows=985 width=57) (actual time=19.593..110.935 rows=15301 loops=1)
  Recheck Cond: ((city = 'Toronto'::text) AND (date >= '2015-07-01'::text) AND (date <= '2015-07-31'::text))
  Heap Blocks: exact=14296
  ->  Bitmap Index Scan on idx_city_date  (cost=0.00..44.87 rows=985 width=0) (actual time=17.561..17.561 rows=15301 loops=1)
        Index Cond: ((city = 'Toronto'::text) AND (date >= '2015-07-01'::text) AND (date <= '2015-07-31'::text))
Planning time: 0.811 ms
Execution time: 111.889 ms</code></pre>
    </p>
    <br>
    So, is it cheeap to add multicolomn indexing? It probably is not in terms of disk space, as we can see the size of the whole table is 851 MB, whereas the size of the index itself is 565 MB. But in some situations it is worth spending that much disk space. 
    <pre><code>select pg_size_pretty(pg_relation_size('weather')); -- 851 MB
select pg_size_pretty(pg_relation_size('idx_city_date')); -- 565 MB</code></pre>
  </div>
</section>
<!--Service-->
<section id="replication"><br><br><br><br><br><br><br><br></section>
<section><!--main-section-start-->
<div class="container">
    <h2>Standby Server using Streaming Replication</h2>
    </div>
  </div>
</section>
<!--main-section-end--> 

<!--Service-->
<section  id="service">
  <div class="container">
    <p>  Recently, we setup a standby server for a client for <a href="https://wiki.postgresql.org/wiki/Streaming_Replication">streaming replication</a>. The master server is setup to work in continous archiving mode, where it stores all queries as log files to a directory. The secondary slave server works in continuous recovery mode, where it reads from those logs and applies to its own databases. This method is called log-shipping. In case of a failure of the master server, the slave server is switched from recover mode to active mode to take over the responsibiity of the master server. 
    </p>
    <br>
    <p>
    On top of the log shipping, the master/slave is also configured so that they communicate through TCP for faster syncing. The slaver server connects to the master and when the master has changes made to it, it will send it to the the slave over TCP.
    </p>
  </div>
</section>
<!--Service-->


<section id="backup"><br><br><br><br><br><br><br><br></section>
<section><!--main-section-start-->
<div class="container">
    <h2>Backup and Recovery</h2>
    </div>
  </div>
</section>
<!--main-section-end--> 

<!--Service-->
<section  id="service">
  <div class="container">
    <p>  We recently have setup <a href="http://www.pgbarman.org/">Barman</a>, a tool by <a href="http://2ndquadrant.com/en/">2ndQuadrant</a> for automatic backup and recovery of PostgreSQL server, based on file system level backup. Barman is written in python, and it features incremental backup, archiving and compressing WAL files and restore policies.   
    </p>
    <br>
    <p>
    It is setup to take a base backup every Sunday and keep one or more archived WAL files. When the system needs a recovery, a new database cluster can be built up to a certain point before the disaster happened. It gives the flexibility that is not possible in using logical backup and restore process, where you lose any changes after that backup was taken. 
    </p>
  </div>
</section>
<!--Service-->

<footer class="footer_section" id="contact">
  <div class="container">
    <section class="main-section contact" id="contact">
      <div class="contact_section">
        <h2>Contact Us</h2>
        <div class="row">
          <div class="col-lg-4">
            <div class="contact_block">
              <div class="contact_block_icon rollIn animated wow"><span><i class="fa-home"></i></span></div>
              <span> 420 Voyaguer Dr, <br>
              Prince George, BC V2M 4P2<br> Canada </span> </div>
          </div>
          <div class="col-lg-4">
            <div class="contact_block">
              <div class="contact_block_icon icon2 rollIn animated wow"><span><i class="fa-phone"></i></span></div>
              <span> 1 604 787 1757 </span> </div>
          </div>
          <div class="col-lg-4">
            <div class="contact_block">
              <div class="contact_block_icon icon3 rollIn animated wow"><span><i class="fa-pencil"></i></span></div>
              <span> <a href="mailto:info@sequelled.com"> info@sequelled.com</a> </span> </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-6 wow fadeInLeft">
          <div class="contact-info-box address clearfix">
            <h3>Don’t be shy. Say hello!</h3>
            <p>Please feel free to contact us to discuss how we can solve your needs regarding PostgreSQL databases and get a free quote.</p>
            
          </div>
          <ul class="social-link">
            <li class="twitter animated bounceIn wow delay-02s"><a href="javascript:void(0)"><i class="fa-twitter"></i></a></li>
            <li class="facebook animated bounceIn wow delay-03s"><a href="javascript:void(0)"><i class="fa-facebook"></i></a></li>
            <li class="pinterest animated bounceIn wow delay-04s"><a href="javascript:void(0)"><i class="fa-pinterest"></i></a></li>
            <li class="gplus animated bounceIn wow delay-05s"><a href="javascript:void(0)"><i class="fa-google-plus"></i></a></li>
            <li class="dribbble animated bounceIn wow delay-06s"><a href="javascript:void(0)"><i class="fa-dribbble"></i></a></li>
          </ul>
        </div>
        <div class="col-lg-6 wow fadeInUp delay-06s">
       
          <form id="contactform" method="POST">
            <input class="input-text animated wow flipInY delay-02s" type="text" name="name" placeholder="Your name *">
            <input class="input-text animated wow flipInY delay-02s" type="email" name="_replyto" placeholder="Your email *">
            <input type="hidden" name="_subject" value="Website contact" />
            <textarea class="input-text text-area animated wow flipInY delay-06s" name="message" placeholder="Your message *"></textarea>
            <input type="text" name="_gotcha" style="display:none" />
            <input class="input-btn animated wow flipInY delay-08s" type="submit" value="Send">
            <input type="hidden" name="_next" value="//sequelled.com#contact" />
        </form>
        <script>
            var contactform =  document.getElementById('contactform');
            contactform.setAttribute('action', '//formspree.io/' + 'info' + '@' + 'sequelled' + '.' + 'com');
        </script>
          
        </div>
      </div>
    </section>
  </div>
  <div class="container">
    <div class="footer_bottom"> <span>Copyright © 2016 sequelled.com | <a href="http://bootstraptaste.com/"> BootstrapTaste </a></span> </div>
    <!-- 
        All links in the footer should remain intact. 
        Licenseing information is available at: http://bootstraptaste.com/license/
        You can buy this theme without footer links online at: http://bootstraptaste.com/buy/?theme=Butterfly
    -->
  </div>
</footer>



<script type="text/javascript">
    $(document).ready(function(e) {
        $('#header_outer').scrollToFixed();
        $('.res-nav_click').click(function(){
            $('.main-nav').slideToggle();
            return false    
            
        });
        
    });
</script> 
<script>
    wow = new WOW(
      {
        animateClass: 'animated',
        offset:       100
      }
    );
    wow.init();
    document.getElementById('').onclick = function() {
      var section = document.createElement('section');
      section.className = 'wow fadeInDown';
	  section.className = 'wow shake';
	  section.className = 'wow zoomIn';
	  section.className = 'wow lightSpeedIn';
      this.parentNode.insertBefore(section, this);
    };
  </script> 
<script type="text/javascript">
	$(window).load(function(){
		
		$('a').bind('click',function(event){
			var $anchor = $(this);
			
			$('html, body').stop().animate({
				scrollTop: $($anchor.attr('href')).offset().top - 91
			}, 1500,'easeInOutExpo');
			/*
			if you don't want to use the easing effects:
			$('html, body').stop().animate({
				scrollTop: $($anchor.attr('href')).offset().top
			}, 1000);
			*/
			event.preventDefault();
		});
	})
</script> 

<!--<script type="text/javascript">

$(window).load(function(){
  
  
  var $container = $('.portfolioContainer'),
      $body = $('body'),
      colW = 350,
      columns = null;

  
  $container.isotope({
    // disable window resizing
    resizable: true,
    masonry: {
      columnWidth: colW
    }
  });
  
  $(window).smartresize(function(){
    // check if columns has changed
    var currentColumns = Math.floor( ( $body.width() -30 ) / colW );
    if ( currentColumns !== columns ) {
      // set new column count
      columns = currentColumns;
      // apply width to container manually, then trigger relayout
      $container.width( columns * colW )
        .isotope('reLayout');
    }
    
  }).smartresize(); // trigger resize to set container width
  $('.portfolioFilter a').click(function(){
        $('.portfolioFilter .current').removeClass('current');
        $(this).addClass('current');
 
        var selector = $(this).attr('data-filter');
        $container.isotope({
			
            filter: selector,
         });
         return false;
    });
  
});

</script>


--> 

<script type="text/javascript">

   
  jQuery(document).ready(function($){     
// Portfolio Isotope
	var container = $('#portfolio-wrap');	
	

	container.isotope({
		animationEngine : 'best-available',
	  	animationOptions: {
	     	duration: 200,
	     	queue: false
	   	},
		layoutMode: 'fitRows'
	});	

	$('#filters a').click(function(){
		$('#filters a').removeClass('active');
		$(this).addClass('active');
		var selector = $(this).attr('data-filter');
	  	container.isotope({ filter: selector });
        setProjects();		
	  	return false;
	});
		
		
		function splitColumns() { 
			var winWidth = $(window).width(), 
				columnNumb = 1;
			
			
			if (winWidth > 1024) {
				columnNumb = 4;
			} else if (winWidth > 900) {
				columnNumb = 2;
			} else if (winWidth > 479) {
				columnNumb = 2;
			} else if (winWidth < 479) {
				columnNumb = 1;
			}
			
			return columnNumb;
		}		
		
		function setColumns() { 
			var winWidth = $(window).width(), 
				columnNumb = splitColumns(), 
				postWidth = Math.floor(winWidth / columnNumb);
			
			container.find('.portfolio-item').each(function () { 
				$(this).css( { 
					width : postWidth + 'px' 
				});
			});
		}		
		
		function setProjects() { 
			setColumns();
			container.isotope('reLayout');
		}		
		
		container.imagesLoaded(function () { 
			setColumns();
		});
		
	
		$(window).bind('resize', function () { 
			setProjects();			
		});

});
$( window ).load(function() {
	jQuery('#all').click();
	return false;
});
</script>
</body>
</html>